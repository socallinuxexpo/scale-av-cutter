scale-av-cutter tools
===

These are scripts that will take the output from the scale-av-cutter Flask app
and actually perform video downloading and post-processing.

Here is the post-processing flow:

![Post-processing flow](docs/scale-postprocessing-flow.png)

Dependencies
---

These tools do not require a server to run, and they have dependencies
independent of those of the main scale-av-cutter Flask app.

Make a new virtualenv, and install the stuff in the requirements.txt.

```
python3 -m venv venv
source venv/bin/activate
pip install --update -r requirements.txt
```

***Note***: You also need the `ffmpeg` executable installed on your system. Please
install it via your system package manager, or compile it yourself and expose
it in PATH.

split.py
---

This script uses the output from the scale-av-cutter app's **/json** endpoint
to download the full day streams from Youtube, and then cut them up into talk
videos based on the timestamps. e.g.:

```
curl -s "$SCALE_AV_CUTTER_URL/json" -b "password=$ADMIN_PASSWORD" > talks.json
./split.py talks.json
```

By default, you'll end up with the roomday videos and cut talks inside
`workdir/`.

Run it with -h to see additional options.


upload.py
---

This script uploads the videos generated by split.py to the user's Youtube
account. It uses the talk metadata in the webapp JSON output, to determine what
title/description to upload the videos with.

To interact with Google's API, we need to understand its flow at a high level.

1. Authentication. This script needs to authenticate to Google, via a "client
   id" and "client secret", so they track the request quota. You can create a
   Google API "client" or "application", and download a `client_secrets.json`
   to use this script, but it'll only have enough quota to upload 4-5 videos.
   Either request a higher limit with Google, or ask a SCaLE AV maintainer for
   a client with higher limit.

2. Authorization. When using this script for the first time, it will ask you to
   login to a Google account, which then authorizes the script (via OAuth) to
   upload videos.

### Behavior

upload.py will upload videos with the exact same title as the talk, and a video
description of the format:

```
{speakers}

{url to talk in SCaLE website}

{talk description}
```

Note that the title and video description will be validated to conform to the
[YouTube
specs](https://developers.google.com/youtube/terms/required-minimum-functionality#data-requirements)
(last checked, 2020-03-17). If invalid, upload.py allows the user to optionally
specify a `youtube_title` and `youtube_description` in the JSON that will be
used for uploading to YouTube.

By default, videos will be uploaded as unlisted, but this can be changed with a
flag if desired.
